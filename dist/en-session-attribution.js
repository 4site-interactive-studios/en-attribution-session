(()=>{"use strict";var e,t=new Uint8Array(16);function n(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}const r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,o=function(e){return"string"==typeof e&&r.test(e)};for(var i=[],s=0;s<256;++s)i.push((s+256).toString(16).substr(1));const a=function(e,t,r){var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=s[a];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!o(n))throw TypeError("Stringified UUID is invalid");return n}(s)};function u(e,t){const n=`${e}=${t}`;return document.cookie=n,n}function c(e,t=""){const n=document.querySelector("script[src*='attribution.js']");if(n){const r=n.getAttribute("session-"+e);return null!=r?r:t}return t}function d(){const e=[],t=new URL(document.location.href);let n;return window.location!==window.parent.location?n=document.location.href:(n=""===document.referrer?"direct":document.referrer,"direct"!==n&&(n=new URL(n).hostname)),e.push(a()),e.push(p()),e.push(p()),e.push("1"),e.push(n),e.push(t.search.slice(1)),e.join("|")}function l(e,t=!0){const n=w(e);n.last_seen=p();const r=new URL(document.location.href);let o;return window.location!==window.parent.location?o=document.location.href:(o=""===document.referrer?"direct":document.referrer,"direct"!==o&&(o=new URL(o).hostname)),t&&(n.page_count=(parseInt(n.page_count)+1).toString()),n.current_url=o,n.current_params=r.search.slice(1),Object.values(n).join("|")}function f(e){let t=window.atob(e);if(e.length>1500&&t.split("|").length>6){const n=w(t);delete n.current_url,delete n.current_params,t=Object.values(n).join("|"),e=window.btoa(t)}return e.length>1500?"":e}function p(e=!0){return e?Math.round(Date.now()/1e3).toString():Math.round(Date.now()/1e3)}function w(e){const t=e.split("|"),n={};return n.uuid=t[0],n.first_seen=t[1],n.last_seen=t[2],n.page_count=t[3],n.first_url=t[4],n.first_params=t[5],t[6]&&(n.current_url=t[6]),t[7]&&(n.current_params=t[7]),n}const m=function(e=!0){var t;const n=window.location.search,r=new URLSearchParams(n);let o="",i="",s=r.get("engrid_session");s=s?window.atob(s):"";let a=function(e){const t=document.cookie.split("; "),n=[],r=[];return t.forEach((e=>{const t=e.split("=");n.push(t[0]),r.push(t[1])})),!!n.includes(e)&&r[n.indexOf(e)]}("engrid_attribution_memory_cookie");a=a?window.atob(a):"";const m=c("mem_attribution"),h=document.querySelector(`input[name="${m}"]`);if(i=h?h.value:"",""!==i&&(i=window.atob(i)),""===i&&""===a&&""===s)o="";else{const e=isNaN(parseInt(w(a).last_seen))?0:parseInt(w(a).last_seen),n=isNaN(parseInt(w(i).last_seen))?0:parseInt(w(i).last_seen),r=isNaN(parseInt(w(s).last_seen))?0:parseInt(w(s).last_seen);o=n<=e?a:i;const u=null!==(t=parseInt(w(o).last_seen))&&void 0!==t?t:0;o=u<=r?s:o}const _=c("length","3600");let g;if(g=""===o||p(!1)-parseInt(w(o).last_seen)>=parseInt(_),"pageJson"in window){o=g?d():l(o,e);let t=window.btoa(o);if(t=f(t),""===t)return;u("engrid_attribution_memory_cookie",t),h&&(h.value=t)}else document.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(n=>{if(/\/page\/[0-9]{5,6}\//.test(t.href)){n.preventDefault();const r=new URL(t.href);o=g?d():l(o,e);let i=window.btoa(o);i=f(i),""===i||(u("engrid_attribution_memory_cookie",i),r.searchParams.set("engrid_session",i)),window.location.href=r.href}}))}))};window.addEventListener("load",(()=>{m()})),window.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&m(!1)}))})();