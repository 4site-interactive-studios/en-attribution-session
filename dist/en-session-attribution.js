(()=>{"use strict";var e,n=new Uint8Array(16);function t(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(n)}const o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(e){return"string"==typeof e&&o.test(e)};for(var i=[],s=0;s<256;++s)i.push((s+256).toString(16).substr(1));const a=function(e,n,o){var s=(e=e||{}).random||(e.rng||t)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,n){o=o||0;for(var a=0;a<16;++a)n[o+a]=s[a];return n}return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(i[e[n+0]]+i[e[n+1]]+i[e[n+2]]+i[e[n+3]]+"-"+i[e[n+4]]+i[e[n+5]]+"-"+i[e[n+6]]+i[e[n+7]]+"-"+i[e[n+8]]+i[e[n+9]]+"-"+i[e[n+10]]+i[e[n+11]]+i[e[n+12]]+i[e[n+13]]+i[e[n+14]]+i[e[n+15]]).toLowerCase();if(!r(t))throw TypeError("Stringified UUID is invalid");return t}(s)};function c(e,n,t=d("expiration","3600")){const o=new Date,r=1e3*parseInt(t)+o.getTime();o.setTime(r);const i=`${e}=${n};expires=${o.toUTCString()};path=/`;return document.cookie=i,i}function d(e,n=""){const t=document.querySelector("script[src*='attribution.js']");if(t){const o=t.getAttribute("session-"+e);return null!=o?o:n}return n}function l(){const e=[],n=new URL(document.location.href);let t;return window.location!==window.parent.location?t=document.referrer:(t=""===document.referrer?"direct":document.referrer,"direct"!==t&&(t=new URL(t).hostname)),n.searchParams.delete("engrid_session"),e.push(a()),e.push(p().toString()),e.push(p().toString()),e.push("1"),e.push(t),n.search.length>0?e.push(n.search.slice(1)):e.push(""),e.join("|")}function u(e,n=!0){const t=m(e);t.last_seen=p().toString();const o=new URL(document.location.href);let r;return window.location!==window.parent.location?r=document.location.href:(r=""===document.referrer?"direct":document.referrer,"direct"!==r&&(r=new URL(r).hostname)),n&&(t.page_count=(parseInt(t.page_count)+1).toString()),o.searchParams.delete("engrid_session"),t.current_referral=r,t.current_referral_params=o.search.length>0?o.search.slice(1):"",Object.values(t).join("|")}function w(e){let n=window.atob(e);if(e.length>1500&&n.split("|").length>6){const t=m(n);delete t.current_referral,delete t.current_referral_params,n=Object.values(t).join("|"),e=window.btoa(n)}return e.length>1500?"":e}function p(){return Math.round(Date.now()/1e3)}function m(e){if(-1===e.indexOf("Parameter")){const n=e.split("|"),t={};return t.uuid=n[0],t.first_seen=n[1],t.last_seen=n[2],t.page_count=n[3],t.first_referral=n[4],t.first_referral_params=n[5],n[6]&&(t.current_referral=n[6]),n[7]&&(t.current_referral_params=n[7]),t}{const n=e.slice(e.indexOf("{"));return JSON.parse(n)}}function f(e=!0,n=""){var t,o;const r=window.location.search;let i="",s="";const a=new URLSearchParams(r).get("engrid_session");let f;a&&(f=window.atob(a));let g=function(e){const n=document.cookie.split("; "),t=[],o=[];return n.forEach((e=>{const n=e.split("=");t.push(n[0]),o.push(n[1])})),t.includes(e)?o[t.indexOf(e)]:""}("engrid_attribution_memory_cookie");g&&(g=window.atob(g));const h=d("additional_comments"),_=document.querySelector(`[name='${h}']`),v=window.additionalCommentsTag;if(v&&(s=v),null==s&&null==g&&null==f)i="";else{const e=""===g?0:parseInt(m(g).last_seen),n=void 0===f?0:parseInt(m(s).last_seen),o=void 0===f?0:parseInt(m(f).last_seen);i=n<=e?g:s;const r=null!==(t=parseInt(m(i).last_seen))&&void 0!==t?t:0;i=void 0===f||o<=r?i:f}void 0!==f&&(i=f);const y=d("expiration","3600");let b;const S=m(i);if(b=""===i||p()-parseInt(S.last_seen)>=parseInt(y),"pageJson"in window){i=b?l():u(i,e),window.location!==window.parent.location&&""!==n&&(i=n);let t=window.btoa(i);if(t=w(t),""===t)return;if(c("engrid_attribution_memory_cookie",t),_&&(_.value=JSON.stringify(m(i))),!document.querySelector("[name='transaction.comments]'")){const e=document.createElement("input");e.classList.add("en__field__input"),e.classList.add("en__field__input--hidden"),e.setAttribute("type","hidden"),e.setAttribute("name","transaction.comments");const n="Parameter tracking: "+JSON.stringify(m(i),null,"\n");e.value=n,null===(o=document.querySelector("form.en__component"))||void 0===o||o.appendChild(e)}}else{i=b?l():u(i,e);let n=window.btoa(i);n=w(n),c("engrid_attribution_memory_cookie",n),document.addEventListener("click",(e=>{const t=e.target;if(t&&"A"===t.tagName&&/\/page\/[0-9]{5,6}\//.test(t.href)){e.preventDefault();const o=new URL(t.href);""===n||o.searchParams.set("engrid_session",n),window.location.href=o.href}}))}const L=new URL(document.location.href);return window.location===window.parent.location&&"true"===L.searchParams.get("debug")&&function(e){const n=document.querySelector(".currentSession");n&&(n.innerHTML="Current session: "+e);const t=m(e);window.location!==window.parent.location?console.log("[iframe session]",t):console.log("[page session]",t);const o=document.querySelector("[name='transaction.comments']");o&&console.log("[Additional Comments Field]\n",o.value)}(i),i}let g,h;window.addEventListener("load",(()=>{window.location===window.parent.location?(h=f(),g=setInterval((()=>{h=f(!1)}),6e4)):setTimeout((()=>{window.parent.postMessage("Mirror session","*")}),1e3)})),window.addEventListener("visibilitychange",(()=>{if(window.location===window.parent.location&&"visible"===document.visibilityState){const e=!1;f(e),g=setInterval((()=>{f(e)}),6e4)}else clearInterval(g)})),window.addEventListener("message",(function(e){var n,t;window.location!==window.parent.location&&"Mirror session"!==e.data?f(!1,e.data):window.location===window.parent.location&&"Mirror session"===e.data&&(h=f(!1),null===(t=null===(n=this.document.querySelector("iframe"))||void 0===n?void 0:n.contentWindow)||void 0===t||t.postMessage(h,"*"))})),document.addEventListener("click",(()=>{window.location!==window.parent.location&&window.parent.postMessage("Mirror session","*")}))})();