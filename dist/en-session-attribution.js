(()=>{"use strict";var t,n=new Uint8Array(16);function e(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}const o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,i=function(t){return"string"==typeof t&&o.test(t)};for(var r=[],s=0;s<256;++s)r.push((s+256).toString(16).substr(1));const a=function(t,n,o){var s=(t=t||{}).random||(t.rng||e)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,n){o=o||0;for(var a=0;a<16;++a)n[o+a]=s[a];return n}return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=(r[t[n+0]]+r[t[n+1]]+r[t[n+2]]+r[t[n+3]]+"-"+r[t[n+4]]+r[t[n+5]]+"-"+r[t[n+6]]+r[t[n+7]]+"-"+r[t[n+8]]+r[t[n+9]]+"-"+r[t[n+10]]+r[t[n+11]]+r[t[n+12]]+r[t[n+13]]+r[t[n+14]]+r[t[n+15]]).toLowerCase();if(!i(e))throw TypeError("Stringified UUID is invalid");return e}(s)};function u(t,n){const e=`${t}=${n}`;return document.cookie=e,e}function c(t,n=""){const e=document.querySelector("script[src*='attribution.js']");if(e){const o=e.getAttribute("session-"+t);return null!=o?o:n}return n}function l(){const t=[],n=new URL(window.location.href);return t.push(a()),t.push(f()),t.push(f()),t.push("1"),t.push(n.hostname),t.push(n.search.slice(1,-1)),t.join("|")}function d(t){const n=t.split("|");if(n[2]=f(),n[3]=(parseInt(n[3])+1).toString(),6===n.length){const t=new URL(window.location.href);n.push(t.hostname),n.push(t.search.slice(1,-1))}else{const t=new URL(window.location.href);n[6]=t.hostname,n[7]=t.search.slice(1,-1)}return n.join("|")}function p(t){let n=window.atob(t);if(t.length>1500&&n.split("|").length>6){const e=n.split("|");for(;e.length>6;)e.pop();n=e.join("|"),t=window.btoa(n)}return t.length>1500?"":t}function f(t=!0){return t?Math.round(Date.now()/1e3).toString():Math.round(Date.now()/1e3)}const h=function(){var t,n,e,o;const i=window.location.search,r=new URLSearchParams(i);let s="",a="",h=r.get("engrid_session");h=h?window.atob(h):"";let w=function(t){const n=document.cookie.split("; "),e=[],o=[];return n.forEach((t=>{const n=t.split("=");e.push(n[0]),o.push(n[1])})),!!e.includes(t)&&o[e.indexOf(t)]}("engrid_attribution_memory_cookie");w=w?window.atob(w):"";const g=c("mem_attribution"),m=document.querySelector(`input[name="${g}"]`);if(console.log(m),console.log(g),a=m?m.value:"",""!==a&&(a=window.atob(a)),""===a&&""===w&&""===h)s="";else{const i=null!==(t=parseInt(w.split("|")[2]))&&void 0!==t?t:0,r=null!==(n=parseInt(a.split("|")[2]))&&void 0!==n?n:0,u=null!==(e=parseInt(h.split("|")[2]))&&void 0!==e?e:0;s=r<=i?w:a;const c=null!==(o=parseInt(s.split("|")[2]))&&void 0!==o?o:0;s=c<=u?h:s}const y=c("length","3600");let v;if(v=""===s||f(!1)-parseInt(s.split("|")[2])>=parseInt(y),"pageJson"in window){s=v?l():d(s);let t=window.btoa(s);if(t=p(t),""===t)return;u("engrid_attribution_memory_cookie",t),m&&(m.value=t)}else document.querySelectorAll("a").forEach((t=>{t.addEventListener("click",(n=>{if(/\/page\/[0-9]{5,6}\//.test(t.href)){n.preventDefault();const e=new URL(t.href);s=v?l():d(s);let o=window.btoa(s);o=p(o),""===o||(u("engrid_attribution_memory_cookie",o),e.searchParams.set("engrid_session",o)),window.location.href=e.href}}))}))};window.addEventListener("load",(t=>{h()})),window.addEventListener("visibilitychange",(t=>{"visible"===document.visibilityState&&h()}))})();