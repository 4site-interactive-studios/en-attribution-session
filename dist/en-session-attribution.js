(()=>{"use strict";var t,e=new Uint8Array(16);function n(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(t){return"string"==typeof t&&o.test(t)};for(var i=[],s=0;s<256;++s)i.push((s+256).toString(16).substr(1));const a=function(t,e,o){var s=(t=t||{}).random||(t.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){o=o||0;for(var a=0;a<16;++a)e[o+a]=s[a];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase();if(!r(n))throw TypeError("Stringified UUID is invalid");return n}(s)};function c(t,e){const n=`${t}=${e}`;return document.cookie=n,n}function u(t,e=""){const n=document.querySelector("script[src*='attribution.js']");if(n){const o=n.getAttribute("session-"+t);return null!=o?o:e}return e}function d(){const t=[],e=new URL(document.location.href);let n;return window.location!==window.parent.location?n=document.location.href:(n=""===document.referrer?"direct":document.referrer,"direct"!==n&&(n=new URL(n).hostname)),t.push(a()),t.push(f()),t.push(f()),t.push("1"),t.push(n),t.push(e.search.slice(1)),t.join("|")}function l(t,e=!0){const n=t.split("|");n[2]=f();const o=new URL(document.location.href);let r;return window.location!==window.parent.location?r=document.location.href:(r=""===document.referrer?"direct":document.referrer,"direct"!==r&&(r=new URL(r).hostname)),e&&(n[3]=(parseInt(n[3])+1).toString()),6===n.length?(n.push(r),n.push(o.search.slice(1))):(n[6]=r,n[7]=o.search.slice(1)),n.join("|")}function p(t){let e=window.atob(t);if(t.length>1500&&e.split("|").length>6){const n=e.split("|");for(;n.length>6;)n.pop();e=n.join("|"),t=window.btoa(e)}return t.length>1500?"":t}function f(t=!0){return t?Math.round(Date.now()/1e3).toString():Math.round(Date.now()/1e3)}function w(t){return t.split("|")[2]}const h=function(t=!0){var e;const n=window.location.search,o=new URLSearchParams(n);let r="",i="",s=o.get("engrid_session");s=s?window.atob(s):"";let a=function(t){const e=document.cookie.split("; "),n=[],o=[];return e.forEach((t=>{const e=t.split("=");n.push(e[0]),o.push(e[1])})),!!n.includes(t)&&o[n.indexOf(t)]}("engrid_attribution_memory_cookie");a=a?window.atob(a):"";const h=u("mem_attribution"),m=document.querySelector(`input[name="${h}"]`);if(i=m?m.value:"",""!==i&&(i=window.atob(i)),""===i&&""===a&&""===s)r="";else{const t=isNaN(parseInt(w(a)))?0:parseInt(w(a)),n=isNaN(parseInt(w(i)))?0:parseInt(w(i)),o=isNaN(parseInt(w(s)))?0:parseInt(w(s));r=n<=t?a:i;const c=null!==(e=parseInt(w(r)))&&void 0!==e?e:0;r=c<=o?s:r}const g=u("length","3600");let y;if(y=""===r||f(!1)-parseInt(w(r))>=parseInt(g),"pageJson"in window){r=y?d():l(r,t);let e=window.btoa(r);if(e=p(e),""===e)return;c("engrid_attribution_memory_cookie",e),m&&(m.value=e)}else document.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(n=>{if(/\/page\/[0-9]{5,6}\//.test(e.href)){n.preventDefault();const o=new URL(e.href);r=y?d():l(r,t);let i=window.btoa(r);i=p(i),""===i||(c("engrid_attribution_memory_cookie",i),o.searchParams.set("engrid_session",i)),window.location.href=o.href}}))}))};window.addEventListener("load",(()=>{h()})),window.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&h(!1)}))})();